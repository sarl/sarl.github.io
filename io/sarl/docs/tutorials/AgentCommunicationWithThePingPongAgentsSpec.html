<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" href="../../../../images/favicon.ico">
<link rel="icon" href="../../../../images/favicon.ico">
<meta charset="utf-8">
<title>Agent Communication with the Ping Pong Agents</title>
<meta name="description" content="">
<meta name="author" content="Jnario">

<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<link rel="stylesheet" href="../../../../css/bootstrap.min.css">
<link rel="stylesheet" href="../../../../css/bootstrap-responsive.min.css">
<link rel="stylesheet" href="../../../../css/custom.css">
<link rel="stylesheet" href="../../../../css/prettify.css">
<script type="text/javascript" src="../../../../js/prettify.js"></script>
<script type="text/javascript" src="../../../../js/lang-jnario.js"></script>
<script type="text/javascript" src="../../../../js/jquery.js"></script>
<script type="text/javascript" src="../../../../js/bootstrap-tab.js"></script>
</head>

<body onload="prettyPrint()">

<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.sarl.io">SARL</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="../../../../index.html">Home</a></li>
        <li><a href="../../../../docs/index.html">Documentation</a></li>
        <li><a href="../../../../download/index.html">Download</a></li>
        <li><a href="../../../../runtime/index.html">Run-time</a></li>
        <li><a href="../../../../news/index.html">News &amp; Events</a></li>
        <li><a href="../../../../publications/index.html">Publications &amp; Presentations</a></li>
        <li><a href="../../../../about/index.html">About</a></li>
      </ul>
    </div>
<!--/.nav-collapse -->
  </div>
</div>
<div class="container">
<h1>Agent Communication with the Ping Pong Agents</h1>
<ul class="page_outline" id="page_outline"><li><a href="#Event_definition">Event definition</a></li><li><a href="#Pong_agent">Pong agent</a></li><li><a href="#Ping_Agent">Ping Agent</a></li><li><a href="#Compile_and_Launch_the_agents">Compile and Launch the agents</a></li></ul><p>This document describes how to create a simple agent-based application in which agents are exchanging basic messages. Before reading this document, it is recommended reading the <a href="../reference/GeneralSyntaxReferenceSpec.html">General Syntax Reference</a>.</p>
<div class="bt-download">
<a href="http://maven.sarl.io/last-demos-release.jar"><img alt="Download the Binary JAR file" src="http://www.sarl.io/images/download-icon.png"></a>
</div>
<p>The elements that are explained in this tutorial are:</p>
<ul>
  <li>the definition of an event;</li>
  <li>the definition of an agent;</li>
  <li>the sending of an event occurrence in the default space;</li>
  <li>the receiving of event occurrences; and</li>
  <li>the definition of a <em>proactive</em> behavior: waiting for partners.</li>
</ul>
<p>The source code related to this tutorial may be found in the <a href="https://github.com/sarl/sarl-demos/tree/master/src/main/sarl/io/sarl/docs/tutorials/pingpong">SARL demos</a>.</p>
<ul><li>
<p id="Principle_of_the_Application" class="example passed"><strong>Principle of the Application</strong></p>
<p>The principle of the application is the following:</p>
<ul>
  <li>The <code>Ping</code> agent is sending a <code>Ping</code> message to all agents.</li>
  <li>The <code>Pong</code> agent is receiving the <code>Ping</code> message, and replies  with a <code>Pong</code> message to the sender of the <code>Ping</code> message.</li>
  <li>The <code>Ping</code> agent is receiving a <code>Pong</code> message and  replies to the sender of the <code>Pong</code> with a new <code>Ping</code> message.</li>
</ul>
<p>These messages contain an integer number that indicates the number of the event.</p>
<center><img src="./pingpong.png"></center>
</li></ul>
<h3 class="exampleGroup passed" id="Event_definition">Event definition</h3>
<p>First, the <code>Ping</code> and <code>Pong</code> events must be defined.</p>
<ul>
<li>
<p id="Ping_Event" class="example passed"><strong>Ping Event</strong></p>
<p>The <code>Ping</code> is an event that contains the index of the event. This index indicates at which position the event is located in the sequence of sent <code>Ping</code> event.</p>
<p>The <code>index</code> attribute is a <em>value</em>, for making it unmodifiable after its initialization.</p>
<p>For setting the value of the <code>index</code> value, it is mandatory to define a constructor.</p>
<pre class="prettyprint lang-spec linenums">
package io.sarl.docs.tutorials.pingpong
event Ping {
  val index : int
  new(i : int) {
    this.index = i
  }
}</pre>
</li>
<li>
<p id="Pong_Event" class="example passed"><strong>Pong Event</strong></p>
<p>The <code>Pong</code> is an event that contains the index of the <code>Ping</code> event for which the <code>Pong</code> event is created.</p>
<p>The <code>index</code> attribute is also a <em>value</em>, and it must be set in a constructor.</p>
<pre class="prettyprint lang-spec linenums">
event Pong {
  val index : int
  new(i : int) {
    this.index = i
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Pong_agent">Pong agent</h3>
<p>The second step of this tutorial is the definition of the agent that is waiting for <code>Ping</code> events, and replying <code>Pong</code> events.</p>
<ul>
<li>
<p id="First_definition" class="example passed"><strong>First definition</strong></p>
<p>The initial definition of the pong agent is:</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
}</pre>
</li>
<li>
<p id="Handling_the_Ping_event" class="example passed"><strong>Handling the Ping event</strong></p>
<p>The pong agent needs to handle the <code>Ping</code> events. For that, a "behavior unit" must be defined in the agent. According to the <a href="../reference/AgentReferenceSpec.html">Agent Reference</a>, the <code>on</code> keyword followed by the name of the event permits to define a handler of events. This handler will be invoked by the runtime environment each time the agent is receiving a <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  on Ping {
  }
}</pre>
</li>
<li>
<p id="Replying_to_Ping_with_a_Pong" class="example passed"><strong>Replying to Ping with a Pong</strong></p>
<p>Now, it is time to define how the pong agent is replying with a <code>Pong</code> message.</p>
<p>First, sending an event in the default space must be done with a built-in capacity: <code>DefaultContextInteractions</code>. This capacity provides a collection of functions that enable the agent to interact with the default context, and its default space.</p>
<p>For using the capacity, it is recommended declaring it with the <code>uses</code> keyword. This keyword permits the agent to directly call the functions of the capacity as if they were defined as actions in the agent.</p>
<p>The <code>DefaultContextInteractions</code> capacity provides the function <code>emit(Event)</code> for emitting an event in the default space of the default context.</p>
<p>The <code>Pong</code> event must be built with an index value as argument. This argument is the index stored in the <code>Ping</code> event. For accessing the occurrence of the <code>Ping</code> event, you must use the special keyword <code>occurrence</code>. In the following example, the <code>Pong</code> event is built with the index argument stored in the received <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  uses DefaultContextInteractions
  on Ping {
    emit( new Pong( occurrence.index ) )
  }
}</pre>
</li>
<li>
<p id="Restricting_the_scope_of_the_Pong_event" class="example passed"><strong>Restricting the scope of the Pong event</strong></p>
<p>In the previous code, the event is emitted to all the agents belonging to the default space, including the pong agent.</p>
<p>For restricting the receiver of the <code>Pong</code> event to the initial sender of the <code>Ping</code> event, you must define a scope for the <code>Pong</code> event. The <code>DefaultContextInteractions</code> capacity provides the function <code>emit(Event, Scope&lt;Address&gt;)</code> for sending an event with a specific scope.</p>
<p>The SARL SDK contains the class <code>AddressScope</code>. It is an implementation of a <code>Scope</code> on addresses (an address is the identifier of an agent in the default space). The creation of an instance of <code>AddressScope</code> is done with the utility function <code>Scopes.addresses(Address*)</code>, which is getting a collection of addresses for building the matching predicate in the scope.</p>
<p>In the following code, the scope permits to restrict to the initial sender of the <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  uses DefaultContextInteractions
  on Ping {
    emit(
      new Pong( occurrence.index ),
      Scopes.addresses( occurrence.source )
    )
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Ping_Agent">Ping Agent</h3>
<p>The third step of this tutorial is the definition of the agent that is sending <code>Ping</code> events, and waiting for <code>Pong</code> events.</p>
<ul>
<li>
<p id="First_definition" class="example passed"><strong>First definition</strong></p>
<p>The initial definition of the ping agent is:</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
}</pre>
</li>
<li>
<p id="Handling_the_Pong_event" class="example passed"><strong>Handling the Pong event</strong></p>
<p>The ping agent needs to handle the <code>Pong</code> events. For that, a "behavior unit" must be defined in the agent.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  on Pong {
  }
}</pre>
</li>
<li>
<p id="Re_sending_a_Ping_when_receiving_a_Pong" class="example passed"><strong>Re-sending a Ping when receiving a Pong</strong></p>
<p>When the ping agent is receiving a <code>Pong</code> event, it re-sends a <code>Ping</code> event to the sender of the <code>Pong</code> event. This new <code>Ping</code> event has an index greater than the one of the <code>Pong</code> event.</p>
<p>The receiving of the <code>Ping</code> event is restricted to the sender of the <code>Pong</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      Scopes.addresses( occurrence.source )
    )
  }
}</pre>
</li>
<li>
<p id="Sending_the_first_Ping" class="example passed"><strong>Sending the first Ping</strong></p>
<p>For starting the exchanges among the agents, it is mandatory to send a first occurrence of the <code>Ping</code> event.</p>
<p>This emit is done when the ping agent is started, i.e. when the agent is receiving the <code>Initialize</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      Scopes.addresses( occurrence.source )
    )
  }
  on Initialize {
    emit( new Ping(0) )
  }
}</pre>
</li>
<li>
<p id="Delaying_the_sending_of_the_first_Ping" class="example passed"><strong>Delaying the sending of the first Ping</strong></p>
<p>The previous code has a major problem: if there is no pong agent launched when the ping agent is sending the first <code>Ping</code> event, the application will reach a deadlock, even if the pong agent is launched later.</p>
<p>For solving this problem, the ping agent must wait for sending the initial <code>Ping</code> event until the pong agent is belonging to the default space.</p>
<p>The concrete implementation is based on the <code>Schedules</code> capacity, which provides a collection of functions for creating and launching asynchronous tasks.</p>
<p>In the following code, a task is created with the name <code>waiting_for_partner</code>. This task is executed every second with the <code>every</code> function (given by the <code>Schedules</code> capacity). The code between the brackets contains the statements that will be periodically executed.</p>
<p>In this periodically executed code, the agent is testing if it is the only one agent belonging to the default space. If not, the agent is sending the initial <code>Ping</code> event, and stopping the periodic task.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions, Schedules
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      Scopes.addresses( occurrence.source )
    )
  }
  on Initialize {
    val task = task("waiting_for_partner")
    task.every(1000) [
      if (defaultSpace.participants.size &gt; 1) {
        emit( new Ping(0) )
        task.cancel
      }
    ]
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Compile_and_Launch_the_agents">Compile and Launch the agents</h3>
<p>The fourth step of this tutorial is the definition of the launching process. In the rest of this section, we discuss the use of the <a href="http://www.janusproject.io">Janus runtime environment</a> for running the agents.</p>
<p>The Janus platform is designed to launch a single agent at start-up. Then, this launched agent must spawn the other agents in the system.</p>
<p><span class="label label-warning">Important</span> In this section, we explain how to launch the agents from the command line interface. For launching the agents from the Eclipse IDE, please read <a href="../gettingstarted/RunSARLAgentInTheEclipseIDESpec.html">"Run SARL Agent in the Eclipse IDE"</a>.</p>
<ul><li>
<p id="Compile_the_code" class="example passed"><strong>Compile the code</strong></p>
<p>You must have a file that contains the compiled files of the tutorial, the Janus platform, and all the needed libraries by SARL and Janus.</p>
<p>You could directly download this file by clicking on the download icon at the top of this page; or by compiling the source code yourself.</p>
<p>If you download the source code of the <a href="https://github.com/sarl/sarl-demos">SARL demos</a>, and compile them with <a href="http://maven.apache.org">Maven</a>, you will obtain a JAR file with all the mandatory elements inside. This file is located in the <code>target</code> folder, and it has a name similar to <code>sarl-demos-0.1.0-with-dependencies.jar</code>.</p>
</li></ul>
<div class="level">
<h4 class="exampleGroup passed" id="Method_1_Execute_each_agent_in_their_own_instance_of_Janus">Method 1: Execute each agent in their own instance of Janus</h4>
<p>The principle is to run each agent is a different instance of the Janus platform.</p>
<ul>
<li>
<p id="Execute_with_a_runnable_JAR" class="example passed"><strong>Execute with a runnable JAR</strong></p>
<p>Here, there is two assumptions:</p>
<ol> <li>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code>  is executable, i.e. it can be directly launched by the Java  Virtual Machine.</li> <li>From this file, the JVM is launching the Janus bootstrap automatically, i.e.  it has a Main-Class set to <code>io.janusproject.Boot</code>.</li> </ol> On the command line, you must launch the Janus instances with:
<pre class="prettyprint">java -jar sarl-demos-0.1.0-with-dependencies.jar
     io.sarl.docs.tutorials.pingpong.PongAgent
</pre>
<p>and:</p>
<pre class="prettyprint">java -jar sarl-demos-0.1.0-with-dependencies.jar
     io.sarl.docs.tutorials.pingpong.PingAgent
</pre>
<p>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is explained above. The third arguments are the qualified names of the agents to launch.</p>
</li>
<li>
<p id="Execute_without_a_runnable_JAR" class="example passed"><strong>Execute without a runnable JAR</strong></p>
<p>In opposite to the previous section, we assume that the file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is not executable. On the command line, you must launch Janus with:</p>
<pre class="prettyprint">java -cp sarl-demos-0.1.0-with-dependencies.jar
     io.janusproject.Boot
     io.sarl.docs.tutorials.pingpong.PongAgent
</pre>
<p>and:</p>
<pre class="prettyprint">java -cp sarl-demos-0.1.0-with-dependencies.jar
     io.janusproject.Boot
     io.sarl.docs.tutorials.pingpong.PingAgent
</pre>
<p>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is explained above. The string <code>io.janusproject.Boot</code> specify the Java class to launch: the Janus bootstrap. The first arguments after the bootstraps are the qualified name of the agents to launch.</p>
</li>
</ul>
</div>
<div class="level">
<h4 class="exampleGroup passed" id="Method_2_Execute_all_the_agents_in_a_single_instance_of_Janus">Method 2: Execute all the agents in a single instance of Janus</h4>
<p>The principle is to launch a single instance of Janus, and run all the agents inside. Because of the design of the Janus platform, we must define an agent that will launch the other agents. This agent is named <code>BootAgent</code>. It is defined below.</p>
<ul>
<li>
<p id="Defining_the_Boot_agent" class="example passed"><strong>Defining the Boot agent</strong></p>
<p>The boot agent uses the <code>DefaultContextInteractions</code> capacity for launching agents in the default context. This capacity provides the function <code>spawn(Class&lt;? extends Agent&gt;)</code> for launching an agent of the given type. When the boot agent has launched the two expected agents, it is killing itself. This is done with the <code>killMe</code> function, which is provided by the <code>Lifecycle</code> capacity.</p>
<pre class="prettyprint lang-spec linenums">
agent BootAgent {
  uses DefaultContextInteractions, Lifecycle
  on Initialize {
    spawn( PongAgent )
    spawn( PingAgent )
    killMe
  }
}</pre>
</li>
<li>
<p id="Execute_with_a_runnable_JAR" class="example passed"><strong>Execute with a runnable JAR</strong></p>
<p>Here, there are two assumptions:</p>
<ol> <li>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code>  is runnable, i.e. it can be directly launched by the Java  Virtual Machine.</li> <li>From this file, the JVM is launching the Janus bootstrap automatically, i.e.  it has a Main-Class set to <code>io.janusproject.Boot</code>.</li> </ol> On the command line, you must launch the Janus instance with:
<pre class="prettyprint">java -jar sarl-demos-0.1.0-with-dependencies.jar
     io.sarl.docs.tutorials.pingpong.BootAgent
</pre>
<p>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is explained above. The third argument is the qualified name of the agent to launch.</p>
</li>
<li>
<p id="Execute_without_a_runnable_JAR" class="example passed"><strong>Execute without a runnable JAR</strong></p>
<p>In opposite to the previous section, we assume that the file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is not executable. On the command line, you must launch Janus with:</p>
<pre class="prettyprint">java -cp sarl-demos-0.1.0-with-dependencies.jar
     io.janusproject.Boot
     io.sarl.docs.tutorials.pingpong.BootAgent
</pre>
<p>The file <code>sarl-demos-0.1.0-with-dependencies.jar</code> is explained above. The string <code>io.janusproject.Boot</code> specifies the Java class to launch: the Janus bootstrap. The first argument after the bootstrap is the qualified name of the agent to launch.</p>
</li>
</ul>
</div>
							<div>
<hr>
<p><small>SARL Documentation is generated by <a href="http://www.jnario.org" target="_blank">Jnario</a></small></p>
</div>
</div>
<div class="container">
  <!-- FOOTER -->
  <footer>
    <div class="row">
      
    <div class="col-lg-3">
    <div class="well well-sm">
      
      <center>
      <h2>SARL</h2>
      <div>Agent-Oriented Programming Language</div>
      <img src="../../../../images/SARL-logo.png" style="width:30%;max-width:64px;"><br>
      <small><a href="../../../../images/SARL-logo.png">png</a> · <a href="../../../../images/SARL-logo.svg">svg</a></small>
      </center>
    </div>
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-th-large"></i> Quick Links </h2> 
      <ul>
        <li><a href="../../../../news/index.html">SARL News</a></li>
        <li><a href="../../../../about/index.html">About SARL</a></li>
        <li><a href="../../../../about/index.html">License</a></li>
      </ul>
      </div> 
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-cog"></i> Support</h2>
      <ul>
        <li><a href="http://github.com/sarl/sarl">View on Github</a></li>
        <li><a href="http://github.com/sarl/sarl/issues">Report an Issue</a></li>
      </ul>
      </div> 
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-link"></i> Links</h2>
      <ul>
        <li><a href="http://www.janusproject.io">Janus Project</a></li>
        <li><a href="http://www.gitia.org">GITIA - FRT - UTN</a></li>
        <li><a href="http://www.multiagent.fr">MAS Group - IRTES - UTBM</a></li>
      </ul>
      </div> 
    </div>
    </div>
    
  </footer>
</div>
</body>
</html>
