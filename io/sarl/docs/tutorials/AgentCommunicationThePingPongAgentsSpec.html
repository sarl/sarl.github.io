<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<title>Agent Communication: the Ping Pong Agents</title>
<meta name="description" content="">
<meta name="author" content="Jnario">

<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<link rel="stylesheet" href="../../../../css/bootstrap.min.css">
<link rel="stylesheet" href="../../../../css/bootstrap-responsive.min.css">
<link rel="stylesheet" href="../../../../css/custom.css">
<link rel="stylesheet" href="../../../../css/prettify.css">
<script type="text/javascript" src="../../../../js/prettify.js"></script>
<script type="text/javascript" src="../../../../js/lang-jnario.js"></script>
<script type="text/javascript" src="../../../../js/jquery.js"></script>
<script type="text/javascript" src="../../../../js/bootstrap-tab.js"></script>
</head>

<body onload="prettyPrint()">

<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">SARL</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/">Home</a></li>
        <li><a href="/docs">Documentation</a></li>
        <li><a href="/download">Download</a></li>
        <li><a href="/news">News &amp; Events</a></li>
        <li><a href="/publications">Publications &amp; Presentations</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </div>
<!--/.nav-collapse -->
  </div>
</div>
<div class="container">
<h1>Agent Communication: the Ping Pong Agents</h1>
<p>This document describes how to create a simple agent-based application in which agents are exchanging basic messages. Before reading this document, it is recommended to read the <a href="./GeneralSyntaxReferenceSpec.html">General Syntax Reference</a>.</p>
<p>The elements that are explained in this tutorial are: </p>
<ul> <li>Definition of an event;</li> <li>Definition of an agent;</li> <li>Emit an event occurrence in the default space;</li> <li>Receiving event occurrences;</li> <li>Pro-active behavior: waiting for partners.</li> </ul>
<p>The principle of the application is the following. The <code>Ping</code> agent is sending a <code>Ping</code> message to all agents. The <code>Pong</code> agent is receiving the <code>Ping</code> message, and replies with a <code>Pong</code> message to the sender. The <code>Ping</code> agent is receiving a <code>Pong</code> message and replies to the sender with a new <code>Ping</code> message. These messages contains an integer number that indicates the number of the event.</p>
<p>The source code related to this tutorial may be found in the <a href="http://www.github/sarl/sarl-demos">SARL demos</a>.</p>
<h3 class="exampleGroup passed" id="Event_definition">Event definition</h3>
<p>First, the <code>Ping</code> and <code>Pong</code> events must be defined.</p>
<ul>
<li>
<p id="Ping_Event" class="example passed"><strong>Ping Event</strong></p>
<p>The <code>Ping</code> is an event that contains the index of the event. This index indicates at which position the event is located in the sequence of sent <code>Ping</code> event.</p>
<p>The <code>index</code> attribute is a value to make it unmodifiable after its initialization.</p>
<p>For setting the value of the <code>index</code> value, it is mandatory to define a constructor.</p>
<pre class="prettyprint lang-spec linenums">
event Ping {
  val index : int
  new(i : int) {
    this.index = i
  }
}</pre>
</li>
<li>
<p id="Pong_Event" class="example passed"><strong>Pong Event</strong></p>
<p>The <code>Pong</code> is an event that contains the index of the <code>Ping</code> event for which the <code>Pong</code> event is created.</p>
<p>The <code>index</code> attribute is a value to make it unmodifiable after its initialization.</p>
<p>For setting the value of the <code>index</code> value, it is mandatory to define a constructor.</p>
<pre class="prettyprint lang-spec linenums">
event Pong {
  val index : int
  new(i : int) {
    this.index = i
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Ponging_agent">Ponging agent</h3>
<p>The second step of this tutorial is the definition of the agent that is waiting for <code>Ping</code> events, and replying <code>Pong</code> events.</p>
<ul>
<li>
<p id="First_definition" class="example passed"><strong>First definition</strong></p>
<p>The initial defintion of the ponging agent is:</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
}</pre>
</li>
<li>
<p id="Handling_the_Ping_event" class="example passed"><strong>Handling the Ping event</strong></p>
<p>The ponging agent needs to handle the <code>Ping</code> events. For that, a "behavior unit" must be defined in the agent. According to the <a href="../reference/GeneralSyntaxReferenceSpec.html">General Syntax Reference</a>, the <code>on</code> keyword followed by the name of the event permits to define a handler of events. This handler will be invoked by the runtime environment each time the agent is receiving a <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  on Ping {
  }
}</pre>
</li>
<li>
<p id="Replying_to_Ping_with_a_Pong" class="example passed"><strong>Replying to Ping with a Pong</strong></p>
<p>Now, it is time to define how the ponging agent is replying with a <code>Pong</code> message.</p>
<p>First, emitting an event in the default space must be done with a builtin capacity: <code>DefaultContextInteractions</code>. This capacity provides a collection of functions that enables the agent to interect with the default context, and its default space.</p>
<p>For using the capacity, it is recommended to declare it with the <code>uses</code> keyword. This keyword permits to the agent to directly call the functions of the capacity as if they are defined as actions in the agent.</p>
<p>The <code>DefaultContextInteractions</code> capacity provides the function <code>emit(Event)</code> for emitting an event in the default space of the default context.</p>
<p>The <code>Pong</code> event must be built with a index value as parameter. This parameter is the index stored in the <code>Ping</code> event. For accessing to the occurrence of the <code>Ping</code> event, you must use the special keyword <code>occurrence</code>. In the following example, the <code>Pong</code> event is built with the index parameter stored in the received <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  uses DefaultContextInteractions
  on Ping {
    emit( new Pong( occurrence.index ) )
  }
}</pre>
</li>
<li>
<p id="Restricting_the_scope_of_the_Pong_event" class="example passed"><strong>Restricting the scope of the Pong event</strong></p>
<p>In the previous code, the event is emitted to all the agents belonging to the default space, including the ponging agent.</p>
<p>For restricting the receiver of the <code>Pong</code> event to the initial sender of the <code>Ping</code> event, you must define a scope for the <code>Pong</code> event. The <code>DefaultContextInteractions</code> capacity provides the function <code>emit(Event, Scope&lt;Address&gt;)</code> for emitting an event with a specific scope.</p>
<p>The SARL SDK contains the class <code>AddressScope</code>. It is an implementation of a <code>Scope</code>. It provides a factory function for creating a scope on addresses (an address is the identifier of an agent in the default space).</p>
<p>In the following code, the scope permits to restrict to the initial sender of the <code>Ping</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PongAgent {
  uses DefaultContextInteractions
  on Ping {
    emit(
      new Pong( occurrence.index ),
      AddressScope.getScope( occurrence.source )
    )
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Pinging_Agent">Pinging Agent</h3>
<p>The third step of this tutorial is the definition of the agent that is sending <code>Ping</code> events, and waiting for <code>Pong</code> events.</p>
<ul>
<li>
<p id="First_definition" class="example passed"><strong>First definition</strong></p>
<p>The initial defintion of the pinging agent is:</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
}</pre>
</li>
<li>
<p id="Handling_the_Pong_event" class="example passed"><strong>Handling the Pong event</strong></p>
<p>The pinging agent needs to handle the <code>Pong</code> events. For that, a "behavior unit" must be defined in the agent.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  on Pong {
  }
}</pre>
</li>
<li>
<p id="Re_sending_a_Ping_on_Pong_reception" class="example passed"><strong>Re-sending a Ping on Pong reception</strong></p>
<p>When the pinging agent is receiving a <code>Pong</code> event, it re-sends a <code>Ping</code> event to the sender of the <code>Pong</code> event. This new <code>Ping</code> event has an index greater than the one of the <code>Pong</code> event.</p>
<p>The reception of the <code>Ping</code> event is restricted to the sender of the <code>Pong</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      AddressScope.getScope( occurrence.source )
    )
  }
}</pre>
</li>
<li>
<p id="Sending_the_first_Ping" class="example passed"><strong>Sending the first Ping</strong></p>
<p>For starting the exchanges among the agents, it is mandatory to send a first occurence of the <code>Ping</code> event.</p>
<p>This emission is done when the pinging agent is started, i.e. when the agent is receiving the <code>Initialize</code> event.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      AddressScope.getScope( occurrence.source )
    )
  }
  on Initialize {
    emit( new Ping(0) )
  }
}</pre>
</li>
<li>
<p id="Delaying_the_sending_of_the_first_Ping" class="example passed"><strong>Delaying the sending of the first Ping</strong></p>
<p>The previous code has a major problem: if there is no ponging agent launched when the pinging agent is emitting the first <code>Ping</code> event, the application will reach a deadlock, even if the ponging agent is launched later.</p>
<p>For solving this problem, the pinging agent must wait for sending the initial <code>Ping</code> event until the ponging agent is belonging to the default space.</p>
<p>The concrete implementation is based on the <code>Schedules</code> capacity, which provides a collection of functions for creating and launching asynchronous tasks.</p>
<p>In following code, a task is created with the name <code>waiting_for_partner</code>. This task is executed every second with the <code>every</code> function. The code between the brackets is the instruction block that will be periodically executed.</p>
<p>In this periodically executed code, the agent is testing if it is the only one agent belonging to the default space. If not, the agent is emitting the initial <code>Ping</code> event, and stopping the periodic task.</p>
<pre class="prettyprint lang-spec linenums">
agent PingAgent {
  uses DefaultContextInteractions, Schedules
  on Pong {
    emit(
      new Ping( occurrence.index + 1 ),
      AddressScope.getScope( occurrence.source )
    )
  }
  on Initialize {
    val task = task("waiting_for_partner")
    task.every(1000) [
      if (defaultSpace.participants.size &gt; 1) {
        emit( new Ping(0) )
        task.cancel
      }
    ]
  }
}</pre>
</li>
</ul>
<h3 class="exampleGroup passed" id="Launching_the_agents">Launching the agents</h3>
<p>The fourth step of this tutorial is the definition of the launching process. In the rest of this section, we discuss the use of the <a href="http://www.janusproject.io">Janus runtime environment</a> for running the agents.</p>
<p>Two methods may be used for launching the agents: </p>
<ol> <li>Execute each agent in a single instance of Janus.<br>  On the command line, you must launch Janu with: <pre class="prettyprint">  java -cp app.jar io.janusproject.Boot io.sarl.docs.tutorials.pingpong.PongAgent  java -cp app.jar io.janusproject.Boot io.sarl.docs.tutorials.pingpong.PingAgent  </pre>  The file <code>app.jar</code> contains the compiled classes of the tutorial,  the Janus platform, and the SARL libraries.</li> <li>Define a specific agent that will launch the two other agents.  This approach is detailed below.</li> </ol>
<ul><li>
<p id="Defining_the_Boot_agent" class="example passed"><strong>Defining the Boot agent</strong></p>
<p>The boot agent uses the <code>DefaultContextInteractions</code> capacity for launching agents in the default context. This capacity provides the function <code>spawn(Class&lt;? extends Agent&gt;)</code> for launching an agent of the given type.</p>
<p>When the boot agent has launched the two expected agents, it is killing itself. This is done with the <code>killMe</code> function, which is provided by the <code>Lifecycle</code> capacity.</p>
<pre class="prettyprint lang-spec linenums">
agent BootAgent {
  uses DefaultContextInteractions, Lifecycle
  on Initialize {
    spawn( PongAgent )
    spawn( PingAgent )
    killMe
  }
}</pre>
</li></ul>
							<div>
<hr>
<p><small>SARL Documentation is generated by <a href="http://www.jnario.org" target="_blank">Jnario</a></small></p>
</div>
</div>
<div class="container">
  <!-- FOOTER -->
  <footer>
    <div class="row">
      
    <div class="col-lg-3">
    <div class="well well-sm">
      
      <center>
      <h2>SARL</h2>
      <div>Agent-Oriented Programming Language</div>
      <img src="/images/SARL-logo.png" style="width:30%"><br>
      <small><a href="/images/SARL-logo.png">png</a> · <a href="/images/SARL-logo.svg">svg</a></small>
      </center>
    </div>
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-th-large"></i> Quick Links </h2> 
      <ul>
        <li><a href="/news">SARL News</a></li>
        <li><a href="/about">About SARL</a></li>
        <li><a href="/about">License</a></li>
      </ul>
      </div> 
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-cog"></i> Support</h2>
      <ul>
        <li><a href="http://github.com/sarl/sarl">View on Github</a></li>
        <li><a href="http://github.com/sarl/sarl/issues">Report an Issue</a></li>
      </ul>
      </div> 
    </div>
    <div class="col-lg-3">
      <div class="well well-sm">
      <h2>
<i class="glyphicon glyphicon-link"></i> Links</h2>
      <ul>
        <li><a href="http://www.janusproject.io">Janus Project</a></li>
        <li><a href="http://www.gitia.org">GITIA - FRT - UTN</a></li>
        <li><a href="http://www.multiagent.fr">MAS Group - IRTES - UTBM</a></li>
      </ul>
      </div> 
    </div>
    </div>
    
  </footer>
</div>
</body>
</html>
